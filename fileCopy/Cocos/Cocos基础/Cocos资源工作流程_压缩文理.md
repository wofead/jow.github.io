



# 资源工作流程-压缩纹理

[toc]

## 配置压缩纹理

Cocos Creator 支持导入多种格式的图片（具体见下表），但是在实际游戏运行中，我们不建议使用原始图片作为资源来加载。比如在手机平台上可能只需要原图 80% 或者更少的画质，又或者是没有使用到透明通道的 `.png` 可以将其转换成 `.jpg`，这样可以减少很大一部分图片的存储空间。

| 图片格式 | Android                                                      | iOS                                                          | Mini Game         | Web                                        |
| :------- | :----------------------------------------------------------- | :----------------------------------------------------------- | :---------------- | :----------------------------------------- |
| PNG      | 支持                                                         | 支持                                                         | 支持              | 支持                                       |
| JPG      | 支持                                                         | 支持                                                         | 支持              | 支持                                       |
| WEBP     | Android 4.0 以上原生支持 其他版本可以使用 [解析库](https://github.com/alexey-pelykh/webp-android-backport) | 可以使用 [解析库](https://github.com/carsonmcdonald/WebP-iOS-example) | 不支持            | [部分支持](https://caniuse.com/#feat=webp) |
| PVR      | 不支持                                                       | 支持                                                         | 支持 iOS 设备     | 支持 iOS 设备                              |
| ETC1     | 支持                                                         | 不支持                                                       | 支持 Android 设备 | 支持 Android 设备                          |
| ETC2     | 只支持生成资源，引擎部分需要参考 PR 自己实现：https://github.com/cocos-creator/engine-native/pull/1685 | -                                                            | -                 | -                                          |

默认情况下 Cocos Creator 在构建的时候输出的是原始图片，如果在构建时需要对某一张图片进行压缩，可以在 **资源管理器** 中选中这张图片，然后在 **属性管理器** 中对图片的纹理格式进行编辑。



## 压缩纹理详解

Cocos Creator 在构建图片的时候，会查找当前图片是否在某平台配置了压缩纹理：

- 如果没有，则继续查找是否做了默认（Default）的配置（如上图），如果没有，则最后按原图输出。
- 如果查找到了压缩纹理的配置，那么会按照找到的配置对图片进行纹理压缩。在一个平台中可以指定多种纹理格式，每种纹理格式在构建时都会根据原图压缩生成一张指定格式的图片。

在运行时，这些生成的图片不会被全部加载，引擎会根据实际设备的支持情况，来选择加载合适格式的图片。[cc.macro.SUPPORT_TEXTURE_FORMATS](https://docs.cocos.com/creator/api/zh/classes/macro.html#supporttextureformats) 列举了目前支持的所有图片格式，引擎加载图片时会从生成的图片中找到在这个列表中 **优先级靠前**（即排列靠前）的格式来加载。

用户可以通过修改 `cc.macro.SUPPORT_TEXTURE_FORMATS` 来自定义平台的图片资源支持情况以及加载顺序的优先级。

## Separate Alpha

ETC1 和 PVR 格式都会用一个固定的空间来存储每个像素的颜色值。当需要存储 RGBA 4 个通道时，图片的显示质量可能会变得非常低。所以提供了一个 Separate Alpha 选项，该选项会将贴图的 Alpha 通道提取出来合并到贴图下方，然后整张贴图按照 RGB 3 个通道的格式来压缩。这样子每个通道的存储空间都得到了提升，贴图的质量也就提升了。

