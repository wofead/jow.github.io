# BombMan关卡的基本制作流程

[toc]

整个关卡的制作分为分为三大部分。分别是表的配置、地图的制作以及怪物的制作。

## 表的配置

设置到关卡部分的表一共有三张，Chapter、Stage和Battle。

其中Chapter表示章节，一个章节可以包含多个**Stage**，一个Stage对应一个**Battle**，在Battle中，有两个元素最为重要，一个是地图Id，一个是怪物Id以及其出生位置，其中出生位置为索引值。并不是具体的坐标。

## 地图

### 拷贝和修改地图

通常我们在制作地图的时候，不需要全部重头来过，我们拷贝复制一份前面的地图，然后增删改就可以了。

下面是具体操作方法：

1. 在`BombMan\Assets\GameAssets\Map`创新新文件夹并命名为要配置的地图ID
2. 在同级目录找一个现在能用的地图预制体拖入Hierarchy界面
3. 右键选中并选择Unpack Prefab Completely得到一个基础的地图(表示修改这个不会修改其它的Prefab)
4. 拖入基础地图到新建文件夹内得到预制体

### 编辑地图

地图中可以配置和修改内容目前有**地形、角色出生点、怪物出生点、Mark点以及破坏链**。

1. **地形**：选中地图中的地形块可以进行移动和缩放，我们也可以增加和删除
2. **角色出生点：**可以通过拖动改变角色出生点的位置
3. **怪物出生点：**地图中的1、2、3......对应在battle中填写的1、2、3.....，也可以增加、删除和移动
4. **Mark点**：标记在地图中的点，在脚本或是技能当中可能会用到
5. **破坏链：**地图破坏

### 导出地图

编辑好地图后，点击Tools下的导出地图信息，会在`BombMan\Assets\GameAssets\Prefabs\Map`目录下会生成一个预制体。

## 怪物

在游戏中，我们的角色行为就那么多，但是我们的怪物种类和形象可以丰富多彩，所以在怪物上面我们的灵活度很高。

### 怪物资源

制作怪物需要以下几个步骤：

1. 使用Spine制作怪物

2. 将怪物导入到Unity中，Skeleton Data拖到Unity选择Skeleton `Mecanim`方法，命名为`Ani`，给这个`Ani`添加父对象，给这个

   父对象添加`RigidBody`和`Collider`，给动画控制器添加`AnimatorStateMachineBehaviour`(点击控制器空白处，会显示base layer)，编辑动画状态机，给`NPC`命名

3. 导出怪物的逻辑信息，Spine、角色和炮弹信息

4. 配置怪物的死亡预制体

这里有个快捷方式，在`Assets/GameAssets/Animation/Infight/Npc`目录下新建一个`NPC`目录，进入里面，右键选择最下面的导入`npc`动画。

在这里我们需要注意几件事情：

1. 创建出来的`GameObjec`t的`Collider`有可能需要调整，如果是带有`Shap`组件，并且里面有`BoneFollower`脚本的`npc`不需要调整`Collider`
2. 需要给控制器进行连线，应该从born（黄色）开始连接，配置条件和调整Setting,还有死亡延时时间需要配置
3. 关于死亡预制体，如果在`Preafab->DeadBody`文件夹下存在同名的文件夹，就会把里面的预制体放到这里来，否则需要自己配置
4. 将预制体拖动到`Preafab->Npc`新建一个文件夹来存放。

### 填表

接下来填写`Npc`在游戏逻辑中的表，包含`npc,Skilltrigger,skill,behavior,buff`这几张表。

1. **`npc`:**在这里填写`npc`的数值信息和技能
2. **`SkillTrigger`:**技能触发条件及其Id
3. **`Skill`:**技能Id及其初始行为
4. **`Behaviour`:**行为链及每个行为能产生的效果
5. **`Buff`:**具体效果

### 必备行为

1. **被命中：**被动移动和主动移动
2. **反击方式：**
   1. 形式上：包括近战和远程
   2. 时机上：什么时候
   3. 对玩家效果：伤害，击飞力度以及角度
3. 回合攻击

### 脚本

现在一般作用在怪物回合，使用一个通用的脚本(释放以一个自身的某个技能)。

如果是需要怪物在其回合内有其特殊的行为需要学习脚本编写。

腾讯的行为树，状态机。

### 组合怪物

**主怪：**在spine中创建单独插槽用于关联子怪，放入一张任意图片，最好为透明，这个插槽在NPC表中需要填写。可以有多个子怪

**子怪：**和单独怪物无区别

**效果传递：**组转信息中配置总闸，单独的buff可以在buff表中配置是否传递

## 需要学习的东西

1. 行为树编辑器
2. Spine
3. Animator



## 

