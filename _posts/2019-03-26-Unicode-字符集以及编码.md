---
layout:     post
title:      Unicode字符集和编码
subtitle:  Unicode
date:       2019-3-26
author:     Jow
header-img: img/post-bg-2015.jpg
catalog: 	 true 
tags:
    - Unicode

---

### 目录
1. 字符集和字符编码
2. 方法1：为每个字符分配固定长度的内存
3. 方法2：为每个字符分配尽量少的内存
4. Unicode 到底使用哪种编码方案
5. 1) UTF-8
6. 2) UTF-32
7. 3) UTF-16

> 无论生活还是工作，自己都应该在寻觅中发现自己究竟身处何方，保持疑问，保持修改，保持尽善尽美，人生当如此，这样才能活出自己想要的样子。

> 对于 ASCII 字符集，这很容易。ASCII 总共包含 128 个字符，用 7 个比特位（Bit）恰好能够存储，不过考虑到计算机一般把字节（Byte）作为基本单元，为了操作方便，我们不妨用一个字节（也就是 8 个比特位）来存储 ASCII。

## 字符集和字符编码

字符集和字符编码不是一个概念，字符集定义了文字和二进制的对应关系，为字符分配了唯一的编号，而字符编码规定了如何将文字的编号存储到内存中。有的字符集在制定时就考虑到了编码的问题，是和编码结合在一起的；有的字符集只管制定字符的编号，至于怎么编码，是其他人的事情。

## 方法1：为每个字符分配固定长度的内存

一种方案是为每个字符分配固定长度的内存，并且这块内存要足够大，可以容纳下所有的字符编号。这种方案最简单，直接将字符编号放入内存中即可，不需要任何转换，并且以后在字符串中定位字符、修改字符都非常容易。

这种方案会浪费很多内存空间，对于以英文为主的国家，比如美国、加拿大、英国等，内存利用率甚至会低于 50%。

## 方法2：为每个字符分配尽量少的内存

改进的思路也很明确，就是把空闲的内存压缩掉，为每个字符分配尽量少的字节，如果全部压缩掉没有标志这个字符应该取几个字节我们又怎么去解析呢？

1. 一是从字符集本身下手，在设计字符集时，刻意让不同的字符编号有不同的特征。

例如，对于编号较小的、用一个字节足以容纳的字符，我们就可以规定这个字符编号的最高位（Bit）必须是 0；对于编号较大的、要用两个字节存储的字符，我们就可以规定这个字符编号的高字节的最高位必须是 1，低字节的最高位必须是 0；对于编号更大的、需要三个字节存储的字符，我们就可以规定这个字符编号的所有字节的最高位都必须是 1。


这种方案的缺点很明显，它会导致字符集不连续，中间留出大量空白区域，这些空白区域不能定义任何字符。

2. 二是从字符编号下手，可以设计一种转换方案，字符编号在存储之前先转换为有特征的、容易定位的编号，读取时再按照相反的过程转换成字符本来的编号。

* 缺点就是多了转换过程，字符在存储和读取时要经过转换，效率低；
* 优点就是在制定字符集时不用考虑存储的问题，可以任意排布字符。

## Unicode 到底使用哪种编码方案
> Unicode 是一个独立的字符集，它并不是和编码绑定的，你可以采用第一种方案，为每个字符分配固定长度的内存，也可以采用第二种方案，为每个字符分配尽量少的内存。
> **Unicode 只是一个字符集，在制定的时候并没有考虑编码的问题，所以采用第二种方案时，就不能从字符集本身下手了，只能从字符编号下手，这样在存储和读取时都要进行适当的转换。**

Unicode 可以使用的编码有三种，分别是：

* UFT-8：一种变长的编码方案，使用 1~6 个字节来存储；
* UFT-32：一种固定长度的编码方案，不管字符编号大小，始终使用 4 个字节来存储；
* UTF-16：介于 UTF-8 和 UTF-32 之间，使用 2 个或者 4 个字节来存储，长度既固定又可变。

>UTF 是 Unicode Transformation Format 的缩写，意思是“Unicode转换格式”，后面的数字表明至少使用多少个比特位（Bit）来存储字符。

### 1) UTF-8

UTF-8 的编码规则很简单：如果只有一个字节，那么最高的比特位为 0；如果有多个字节，那么第一个字节从最高位开始，连续有几个比特位的值为 1，就使用几个字节编码，剩下的字节均以 10 开头。

### 2)UTF-32

UTF-32 是固定长度的编码，始终占用 4 个字节，足以容纳所有的 Unicode 字符，所以直接存储 Unicode 编号即可，不需要任何编码转换。浪费了空间，提高了效率。

### 3) UTF-16

UFT-16 比较奇葩，它使用 2 个或者 4 个字节来存储。


对于 Unicode 编号范围在 0 ~ FFFF 之间的字符，UTF-16 使用两个字节存储，并且直接存储 Unicode 编号，不用进行编码转换，这跟 UTF-32 非常类似。

对于 Unicode 编号范围在 10000\~10FFFF 之间的字符，UTF-16 使用四个字节存储，具体来说就是：将字符编号的所有比特位分成两部分，较高的一些比特位用一个值介于 D800\~DBFF 之间的双字节存储，较低的一些比特位（剩下的比特位）用一个值介于 DC00~DFFF 之间的双字节存储。

位于 D800~0xDFFF 之间的 Unicode 编码是特别为四字节的 UTF-16 编码预留的，所以不应该在这个范围内指定任何字符。如果你真的去查看 Unicode 字符集，会发现这个区间内确实没有收录任何字符。



UTF-16 要求在制定 Unicode 字符集时必须考虑到编码问题，所以真正的 Unicode 字符集也不是随意编排字符的。
